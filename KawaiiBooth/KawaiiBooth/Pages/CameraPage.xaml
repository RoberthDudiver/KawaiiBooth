<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="KawaiiBooth.Pages.CameraPage"
             BackgroundColor="#FFF0F5"
             Title="Photobot"
xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:local="clr-namespace:KawaiiBooth.Pages"

             >
    <Grid>

        <Image Source="background.png"
               Aspect="AspectFill"
               Opacity="0.5"
               
               />
      
        <Grid Padding="10" RowDefinitions="Auto,*,Auto">

    

        <!-- Vista principal -->
        <Grid Grid.Row="1"
              Padding="0"
              Margin="0,10"
              VerticalOptions="FillAndExpand">

            <!-- Marco visual general -->
            <Border Stroke="#F4BBD4"
                    StrokeThickness="10"
                    BackgroundColor="White"
                    StrokeShape="RoundRectangle 30"
                    Padding="0"
                    Margin="10">

                <Grid>
                    <!-- Vista de cámara o imagen -->
              
                        <toolkit:CameraView 
    x:Name="CameraView"
    SelectedCamera="{Binding SelectedCamera}"
    CameraFlashMode="{Binding FlashMode}"
                            
    ZoomFactor="{Binding CurrentZoom}"
    ImageCaptureResolution="{Binding SelectedResolution}"
    />
                        <Image x:Name="PreviewImage"
BackgroundColor="Black" IsVisible="False"
Aspect="AspectFill" />

                        <!-- Semicírculo superior (contador) -->
                    <Border
    x:Name="CountdownSemiCircle"
    WidthRequest="120"
    HeightRequest="60"
    BackgroundColor="#FDE8F0"
    Stroke="#F4BBD4"
    StrokeThickness="5"
    HorizontalOptions="Center"
    VerticalOptions="Start"
    Margin="0,-5,0,0"
    StrokeShape="RoundRectangle 0,0,60,60">

                        <Label
        x:Name="CountdownLabel"
        Text="3"
        FontSize="30"
        HorizontalOptions="Center"
        VerticalOptions="Center"
        TextColor="Red"
        FontAttributes="Bold" />
                    </Border>


                    <!-- Semicírculo inferior (foto actual) -->
                    <Border
    x:Name="PhotoIndexSemiCircle"
    WidthRequest="120"
    HeightRequest="60"
    BackgroundColor="#FDE8F0"
    Stroke="#F4BBD4"
    StrokeThickness="5"
    HorizontalOptions="Center"
    VerticalOptions="End"
    Margin="0,0,0,-5"
    StrokeShape="RoundRectangle 60,60,0,0">

                        <Label
        x:Name="PhotoIndexLabel"
        Text="0-0"
        FontSize="30"
        HorizontalOptions="Center"
        VerticalOptions="Center"
        TextColor="Black"
        FontAttributes="Bold" />
                    </Border>

                </Grid>

            </Border>
        </Grid>

        <!-- Botonera -->
            <Grid Grid.Row="2"
      Margin="0,10,0,20"
      HorizontalOptions="Center">

                <!-- Fondo semitransparente con esquinas redondeadas -->
                <Border BackgroundColor="#CCFFF0F5"  
                    Stroke="#F4BBD4"
            StrokeThickness="2"
            WidthRequest="300"
            HeightRequest="100"
            StrokeShape="RoundRectangle 50"
            VerticalOptions="Center"
            HorizontalOptions="Center"
            />

                    <!-- Botonera encima -->
                    <StackLayout Orientation="Horizontal"
                 HorizontalOptions="Center"
                 VerticalOptions="Center"
                 Spacing="30">

                        <!-- Botón cambiar cámara -->
                        <ImageButton Source="switch_camera.png"
                     WidthRequest="60"
                     HeightRequest="60"
                     BackgroundColor="Pink"
                     CornerRadius="30"
                     Clicked="OnSwitchCameraClicked"/>

                        <!-- Botón tomar foto con borde redondo -->
                        <Border Stroke="HotPink"
                StrokeThickness="3"
                BackgroundColor="White"
                WidthRequest="90"
                HeightRequest="90"
                StrokeShape="RoundRectangle 45"
                VerticalOptions="Center"
                HorizontalOptions="Center">
                            <ImageButton Source="shutter.png"
                         BackgroundColor="Transparent"
                         WidthRequest="80"
                         HeightRequest="80"
                         Clicked="OnTakePhotoClicked" />
                        </Border>

                        <!-- Botón ver foto previa -->
                        <ImageButton Source="preview.png"
                     WidthRequest="60"
                     HeightRequest="60"
                     BackgroundColor="Pink"
                     CornerRadius="30"
                     Clicked="OnPreviewClicked"/>
                    </StackLayout>
            </Grid>

        </Grid>
        <StackLayout x:Name="PopupOverlay"
             IsVisible="False"
             BackgroundColor="#80000000"
             VerticalOptions="FillAndExpand"
             HorizontalOptions="FillAndExpand"
             Padding="0"
             InputTransparent="False"
             ZIndex="100">

            <Grid VerticalOptions="Center"
          HorizontalOptions="Center"
          WidthRequest="320"
          BackgroundColor="Transparent"
          Padding="10">

                <Border
            Stroke="#F4BBD4"
            StrokeThickness="5"
            BackgroundColor="#FFF0F5"
            StrokeShape="RoundRectangle 30"
            Padding="20">

                    <VerticalStackLayout Spacing="20"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center">

                        <!-- Imagen resultante -->
                        <Image x:Name="PopupFinalImage"
                       WidthRequest="240"
                       HeightRequest="360"
                       Aspect="Fill" 
                       BackgroundColor="White"
                       />

                        <!-- Botones -->
                        <local:KawaiiButton2
                    BorderColor="#C8AEE4"
                    TopColor="#E6D6F9"
                    BottomColor="#C8AEE4"
                    GlossColor="#F2E7FB"
                    ImageSource="save.png"
                    Text1="Guardar"
                    Text2="imagen"
                    TapCommand="{Binding SaveTapped}" />

                        <local:KawaiiButton2
                    BorderColor="#F7A1A1"
                    TopColor="#FCDDDD"
                    BottomColor="#F7A1A1"
                    GlossColor="#FFEDED"
                    ImageSource="close.png"
                    Text1="Cerrar"
                    Text2="ventana"
                    TapCommand="{Binding CloseTapped}" />

                    </VerticalStackLayout>
                </Border>
            </Grid>
        </StackLayout>

        <!-- Overlay kawaii de progreso -->
        <Grid x:Name="ProcessingOverlay"
      IsVisible="False"
      BackgroundColor="#80000080"
      VerticalOptions="FillAndExpand"
      HorizontalOptions="FillAndExpand"
      ZIndex="999">

            <!-- Contenedor centrado -->
            <Grid VerticalOptions="Center"
          HorizontalOptions="Center">

                <Border Stroke="#F4BBD4"
                StrokeThickness="5"
                BackgroundColor="#FFF0F5"
                StrokeShape="RoundRectangle 30"
                Padding="30"
                WidthRequest="260">

                    <VerticalStackLayout Spacing="15"
                                  HorizontalOptions="Center"
                                  VerticalOptions="Center">

                        <!-- Icono kawaii -->
                        <Image Source="loading_kawaii.png"
                       WidthRequest="80"
                       HeightRequest="80" />

                        <!-- ActivityIndicator -->
                        <ActivityIndicator IsRunning="True"
                                   Color="#F48FB1"
                                   WidthRequest="50"
                                   HeightRequest="50" />

                        <!-- Texto kawaii -->
                        <Label Text="Procesando..."
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       TextColor="#D81B60"/>
                    </VerticalStackLayout>
                </Border>
            </Grid>
        </Grid>

        <toolkit:MediaElement
    x:Name="ShutterSound"
    Source="shutter.mp3"
    IsVisible="False"
    ShouldAutoPlay="False"
    Volume="1" />
        <!-- Popup kawaii de progreso -->
      
    </Grid>
</ContentPage>
